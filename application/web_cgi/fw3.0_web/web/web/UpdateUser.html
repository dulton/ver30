<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>
            用户添加
        </title>
        <link href="css/inner_frame.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="js/jquery-1.7.1.min.js">
        </script>
        <script type="text/javascript" src="js/ui.core.min.js">
        </script>
        <script type="text/javascript" src="js/ui.slider.min.js">
        </script>
        <script type="text/javascript" src="js/jquery.simplemodal.1.4.2.min.js">
        </script>
        <script type="text/javascript" src="js/menu.js">
        </script>
        <script type="text/javascript" src="js/util.js">
        </script>
        <script type="text/javascript" src="js/SetAndGetValue.js" >
        </script>
        <script type="text/javascript" src="js/js_lang.js">
        </script>
        <script type="text/javascript" src="js/js_cookie.js">
        </script>
        <link type='text/css' href='css/demo.css' rel='stylesheet' media='screen'
        />
        <link type='text/css' href='css/basic1.css' rel='stylesheet' media='screen'
        />
        <script type='text/javascript' src='js/jquery.simplemodal.js'>
        </script>
        <script>
		//设置权限变量
		var spyl = false;
		var rzcx = false;
		var yjkz = false;
		var yydj = false;
		var sptj = false;
		var cspz = false;
		var lxhf = false;
		var yhgl = false;
		var Flag = 0;
		
		var Authvalue = "";
		

		//加载用户信息函数
		function LoadUserInfo()
		{
			var username = getQueryString("usename");
			var userlever = getQueryString("userLever");
			var userflag = getQueryString("useflag"); 
			var userpsw = getQueryString("usepsw");
			
			//显示用户名
			$("#username").val(username);
			//$("#username").val("111");
			//用户类型
			if(userflag == "管理员")
			{
				$("#usertype").val(1);	
			}
			else if(userflag == "操作员")
			{
				$("#usertype").val(2);		
			}
			else if(userflag == "视频预览")
			{
				$("#usertype").val(3);		
			}
			//$("#usertype").val(userflag);
			//密码
			$("#psw").val(userpsw);
			
			//解析userlever
          	var answer = "";
			var Valuetwo;
			var ValueStr = "";
          	if(/\d+/.test(userlever))
			{
            	while(userlever != 0) {
              		answer = Math.abs(userlever%2)+answer;
              		userlever = parseInt(userlever/2);
            	}
            	if(answer.length == 0)
				{
              		answer = "0";
				}

          	}
			else 
			{
						$("#spyl_comp").checked = false;
						$("#rzcx_comp").checked = false;
						$("#yjkz_comp").checked = false;
						$("#yydj_comp").checked = false;
						$("#sptj_comp").checked = false;
						$("#cspz_comp").checked = false;
						$("#lxhf_comp").checked = false;
						$("#yhgl_comp").checked = false;
						//取高八位
            			Valuetwo = answer;
						ValueStr = String(Valuetwo);
						//判断用户管理权限
						if(ValueStr[0] != "1")
						{
							document.getElementById("spyl_comp").checked = true;
							//$("#spyl_comp").checked = true;
						}
						if(ValueStr[1] != "1")
						{
							document.getElementById("yjkz_comp").checked = true;
							//$("#yjkz_comp").checked = true;
						}
						if(ValueStr[2] != "1")
						{
							document.getElementById("sptj_comp").checked = true;
							//$("#sptj_comp").checked = true;
						}
						if(ValueStr[3] != "1")
						{
							document.getElementById("lxhf_comp").checked = true;
							//$("#lxhf_comp").checked = true;
						}
						if(ValueStr[4] != "1")
						{
							document.getElementById("rzcx_comp").checked = true;
							//$("#rzcx_comp").checked = true;
						}
						if(ValueStr[5] != "1")
						{
							document.getElementById("yydj_comp").checked = true;
							//$("#yydj_comp").checked = true;
						}
						if(ValueStr[6] != "1")
						{
							document.getElementById("cspz_comp").checked = true;
							//$("#cspz_comp").checked = true;
						}
						if(ValueStr[7] != "1")
						{
							document.getElementById("yhgl_comp").checked = true;
							//$("#yhgl_comp").checked = true;
						}
          	}
		}
		//初始化函数
		function init()
		{
				//获取参数
				//debugger;
				//Flag = getQueryString("Flag");
				//if(Flag == 0)//添加用户
				//{
				//	$("#username").readOnly = false;
				//	$("#password").readOnly = false;
				//}
				//else if(Flag == 1)//修改用户
				//{
					//$("#username").readOnly = true;

					$("#username").attr("disabled", "disabled");
					//加载用户信息
					LoadUserInfo();
				//}	
		}
            $(document).ready(function()
			{
				init();

				//绑定权限按钮
				$("#spyl_comp").bind("click",function(){
					var ctr = document.getElementById("spyl_comp");
					if(ctr.checked)
					{
						spyl = true;	
					}
					else if(!ctr.checked)
					{
						spyl = false;
					}
					});
				$("#rzcx_comp").bind("click",function(){
					var ctr = document.getElementById("rzcx_comp");
					if(ctr.checked)
					{
						rzcx = true;	
					}
					else if(!ctr.checked)
					{
						rzcx = false;
					}
					});
				$("#yjkz_comp").bind("click",function(){
					var ctr = document.getElementById("yjkz_comp");
					if(ctr.checked)
					{
						yjkz = true;	
					}
					else if(!ctr.checked)
					{
						yjkz = false;
					}
					});
				$("#yydj_comp").bind("click",function(){
					var ctr = document.getElementById("yydj_comp");
					if(ctr.checked)
					{
						yydj = true;	
					}
					else if(!ctr.checked)
					{
						yydj = false;
					}
					});
				$("#sptj_comp").bind("click",function(){
					var ctr = document.getElementById("sptj_comp");
					if(ctr.checked)
					{
						sptj = true;	
					}
					else if(!ctr.checked)
					{
						sptj = false;
					}
					});
				$("#cspz_comp").bind("click",function(){
					var ctr = document.getElementById("cspz_comp");
					if(ctr.checked)
					{
						cspz = true;	
					}
					else if(!ctr.checked)
					{
						cspz = false;
					}
					});
				$("#lxhf_comp").bind("click",function(){
					var ctr = document.getElementById("lxhf_comp");
					if(ctr.checked)
					{
						lxhf = true;	
					}
					else if(!ctr.checked)
					{
						lxhf = false;
					}
					});
				$("#yhgl_comp").bind("click",function(){
					var ctr = document.getElementById("yhgl_comp");
					if(ctr.checked)
					{
						yhgl = true;	
					}
					else if(!ctr.checked)
					{
						yhgl = false;
					}
					});
				//绑定确定按钮
                $("#submitAdduser").bind("click",
                function(e)
				{

					//获取用户名
					var userName = $("#username").val();
					//获取用户类型
					var userType = $("#usertype").val();
					//获取密码
					var userPsw = $("#psw").val();
					if(userName == null || userName == "")
					{
						alert("用户名不能为空!");
						return;
					}
					if(userType == null || userType == "")
					{
						alert("用户类型不能为空!");
						return;
					}
					if(userPsw == null || userPsw == "")
					{
						alert("密码不能为空!");
						return;
					}
					
					//基本权限
				  var  content={};
				  content.SessionId=parent.parent.id;
				  content.AuthValue=parent.parent.Authvalue;
				  
				  //新用户
				  content.UserName = $("#username").val();
				  content.UserPass = $("#psw").val();
				  content.UserFlag = userType;
				  //新用户权限
				  var str = "";
				  //视频预览
				  if(spyl == true){str = "1";}
				  else if(!spyl){str = "0";}
				  
				  //云镜控制
				  if(yjkz == true){str += "1";}
				  else if(!yjkz){str += "0";}
				  
				  //视频调节
				  if(sptj == true){str += "1";}
				  else if(!sptj){str += "0";}
				  //录像回放
				  if(lxhf == true){str += "1";}
				  else if(!lxhf){str += "0";}
				  //日志查询
				  if(rzcx == true){str += "1";}
				  else if(!rzcx){str += "0";}
				  //语音对讲
				  if(yydj == true){str += "1";}
				  else if(!yydj){str += "0";}
				  //参数配置
				  if(cspz == true){str += "1";}
				  else if(!cspz){str += "0";}
				  //用户管理
				  if(yhgl == true){str += "1";}
				  else if(!yhgl){str += "0";}
				  
				  //补齐后24位
				  str += "000000000000000000000000";
				  
				  str = parseInt(str,2);
				  
				  
				  content.UserLevel = str;
				  contentstr=jsonToString(content);
					//如果是修改用户
					//Flag = getQueryString("Flag");
					//if(Flag == 1)
					//{
						GetAndSet("ModifyUsers","json",contentstr, sucess_UpdateUser);
					//}
					//else if(Flag == 0)//添加用户
					//{
					//	GetAndSet("SetUsers","json",contentstr, sucess_addUser);		
					//} 
				  
				  
                });
				
				//绑定取消按钮
				$("#cancelircut").bind("click",
                function(e) {
					parent.getUser();
                    parent.closeframe();
					//window.close();

                });
            });
			//修改用户回调函数
			function sucess_UpdateUser(data)
			{
				var PackDate=new UnPackData(data);
				if(PackDate.Content!=null)
				{
					if(PackDate.Content.RetCode=="0")
					{
						//成功返回
						alert("修改成功！");
						parent.getUser();
                    	parent.closeframe();
					}
					else if(PackDate.Content.RetCode!="0")
					{
						//错误返回
						alert("修改失败!");	
					}
				}
				delete PackDate;	
			}
			//回调函数
			function sucess_addUser(data)
			{
				var PackDate=new UnPackData(data);
				if(PackDate.Content!=null)
				{
					if(PackDate.Content.RetCode=="0")
					{
						//成功返回
						alert("添加成功！");
						parent.getUser();
                    	parent.closeframe();
					}
					else if(PackDate.Content.RetCode!="0")
					{
						//错误返回
						alert("添加失败!");	
					}
				}	
				delete PackDate;
			}

        </script>
    </head>
    
    <body>
        <div id="basic-modal" style="color:#999;">
<h3 style="width:100%; color:#fff; background-color:#000; margin-top:0;height:28px; line-height:26px; font-size:12px; font-weight:normal; padding-left:10px;">
                修改用户：
          </h3>
        <div style="width:400px; height:400px; margin:0 auto; padding-left:10px;">
            
            <dl>
                <dt style="width:200px;">&nbsp;</dt>
                	<div style="width:90%">
                <div class="user_list">
                <div class="user_list1">用户名：</div>
                  <div class="user_list1"><input type="text" id="username" readonly="readonly"></input></div>
                
                </div>
                <div class="user_list">
                <div class="user_list1">用户类型:</div>
                <div class="user_list1">
                  <select id="usertype" >
                    <option value='1'> 管理员 </option>
                    <option value='2'> 操作员 </option>
                    <option value='3'> 视频预览 </option>
                  </select>
                  </div>
                </div>
                <div class="user_list">
              <div class="user_list1">密   码：</div>
              <div class="user_list1">    
                  <input type="password" id="psw"></input></div>
                  </div>
				</div>
                
                <div class="user_list2" style="height:24px;">
                
               <div class="user_list1">基本权限:</div>
              <div class="user_list1">    
                  </div>
                  </div>
            </dl>
          <!--<p>-->
          <div class="user_list3">
            <input id="spyl_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>
          视频预览
          </div>
          <div class="user_list3"><input id="rzcx_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>日志查询</div>
          <div class="user_list3">
		  <input id="yjkz_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>云镜控制</div>
          <div class="user_list3">
          <input id="yydj_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>语音对讲</div>
          <div class="user_list3">
          <input id="sptj_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>视频调节</div>
          <div class="user_list3">
          <input id="cspz_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>参数配置</div>
          <div class="user_list3">
          <input id="lxhf_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>录像回放</div>
          <div class="user_list3">
          <input id="yhgl_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>用户管理</div>
          
		</div>
          
          <div style="width:90%; text-align:center;">
            <input type="button" class="btn3" value="确定" id="submitAdduser"
            />
          <input type="button" class="btn3" value="取消" id="cancelircut"
            /></div>
    </div>

    </body>

</html>