<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script type="text/javascript" src="js/time_s_xxk.js"></script>
 <link href="css/inner_frame.css" type="text/css" rel="stylesheet" /> 
        <script type="text/javascript" src="js/jquery-1.7.1.min.js">
        </script>
        <script type="text/javascript" src="js/jquery.simplemodal.1.4.2.min.js">
        </script>
        <script type="text/javascript" src="js/util.js">
        </script>
        <script type="text/javascript" src="js/SetAndGetValue.js">
        </script>
        <script type="text/javascript" src="js/js_lang.js">
        </script>
        <script type="text/javascript" src="js/js_cookie.js">
        </script>
        <script type="text/javascript" src="js/jquery.funkyUI.js">
        </script>
        <!--表单分页-->
        <link rel="stylesheet" type="text/css" media="screen" href="css/jquery-ui-1.8.21.custom.css"
        />
        <link rel="stylesheet" type="text/css" media="screen" href="css/ui.jqgrid.css"
        />
        <link rel="stylesheet" type="text/css" media="screen" href="css/ui.multiselect.css"
        />
        <script src="js/jquery-ui-1.8.1.custom.min.js" type="text/javascript">
        </script>
        <script src="js/grid.locale-cn.js" type="text/javascript">
        </script>
        <script src="js/ui.multiselect.js" type="text/javascript">
        </script>
        <script src="js/jquery.jqGrid.min.js" type="text/javascript">
        </script>
        <link type='text/css' href='css/demo.css' rel='stylesheet' media='screen'
        />
        <link type='text/css' href='css/basic.css' rel='stylesheet' media='screen'
        />
        <script type='text/javascript' src='js/jquery.simplemodal.js'>
        </script>

        <script> 
		//当前选定的用户
		var UserIndex;
		var UserIndexID = 0;//用户名
		var UserIdexLever = 0;//用户权限
		var UserIndexFlag = 0;//用户类型
		var UserPsw;	//用户密码
		var UserRowIndex = -1;
		var mydata = {};
		//用户数目
		var UserCont=0;

		//var updateid = 0;
		//var addid = 0;
		//var UserIndexFlag = 0;
		//var UserIndexLevel = 0;
//-----------

//-----------
		<!--
		//添加用户
		function openwin()
		{
			//LoadUserDiv();
			/*
					//判断当前身份
					if(parent.UserLevel != 1)
					{
						alert("你没有添加用户的权限！");
						return;
					}
					//判断是否有权限
					var intNum = parent.Authvalue;
					var Valuetwo;
					var ValueStr = "";
					//转换为二进制
          			var answer = "";
          			if(/\d+/.test(intNum)) 
					{
            			while(intNum != 0) {
              			answer = Math.abs(intNum%2)+answer;
              			intNum = parseInt(intNum/2);
            			}
            			if(answer.length == 0)
						{
							answer = "0";	
						}
          			}
					else
					{
						//取高八位
            			Valuetwo = answer;
						ValueStr = String(Valuetwo);
						//判断用户管理权限
						if(ValueStr[7] != "1")
						{
							alert("你没有用户管理权限的权限！");
							return;	
						}
          			}
					*/
//window.open ('addUser.html', 'newwindow', 'height=100, width=400, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=n o, status=no');
/*
var obj = new Object();
obj.name="";
window.showModelessDialog("addUser.html",obj,
center = "yes",//居中
resizable = "no",//大小不可变
status = "no",//显示状态栏
scroll = "no",//显示滚动条
edge = "sunken",//指明对话框的边框样式。默认为raised。
"dialogWidth=500px;dialogHeight=500px");
*/
//alert("hello");

//var result = window.showModalDialog("addUser.html?Flag=0","","dialogHeight:400px; dialogWidth:500px; status:no; help:no; scroll:no");	
		
	
						if(UserCont >= 32)
						{
							alert("用户数目已达上限，无法添加！");
							return;
						}
						var src = "addUser.html";
						$.modal('<iframe src="' + src+"?Flag=0"+ '" height="500" width="500"  frameborder="No" scrolling="No"  style="" border="0" allowtransparency="yes">', {
							containerId: 'simplemodal-container0',
							closeHTML: "",
							onClose: function() {
								//alert("close");
								$.modal.close(); 
								
							},
							containerCss : {height:"500px",
							width:"500px", 
							color:"#999", 
							backgroundcolor:"#242424",
							border:"1px solid #000", 
							padding:"0"},
							overlayClose: false,
							overlayCss : {backgroundcolor:"red"}
						});
						
					
			}
			
			function closeframe()
			{
				$.modal.close();
				return;
			}

			//-->
		//修改用户
		function updateUser()
		{
			//window.showModalDialog("UpdateUser.html??usename="+UserIndexID+"&usepsw="+UserPsw+"&useflag="+UserIndexFlag+"&userLever="+UserIdexLever+"&Flag=1","","dialogHeight:400px; dialogWidth:500px; status:no; help:no; scroll:no");
						if(UserRowIndex <= 0)
						{
							alert("请选择用户！");
							return;
						}
						var src = "UpdateUser.html";
						$.modal('<iframe src="' + "UpdateUser.html"+"?usename="+UserIndexID+"&usepsw="+UserPsw+"&useflag="+UserIndexFlag+"&userLever="+UserIdexLever+"&Flag=1" + '" height="500" width="500"  frameborder="No" scrolling="No"  style="" border="0" allowtransparency="yes">', {
							containerId: 'simplemodal-container1',
							closeHTML: "",
							onClose: function() {
								//alert("close");
								$.modal.close();  
								
							},
							containerCss : {height:"500px",
							width:"500px", 
							color:"#999", 
							backgroundcolor:"#242424",
							border:"1px solid #000", 
							padding:"0"},
							overlayClose: false,
							overlayCss : {backgroundcolor:"red"}
						});	
						
		}
			
		//删除用户
		function deleteUser()
		{
			if(UserRowIndex <= 0)
			{
				alert("请选择用户!");
				return;
			}
			var  content={};
			content.SessionId=parent.parent.id;
			content.AuthValue=parent.parent.Authvalue;
			content.UserName=UserIndexID;
			//content.UserFlag=UserIndexFlag;
			
			contentstr=jsonToString(content);
			GetAndSet("DelUsers","json",contentstr, sucess_deleteUser);	
			
			
		}
		//删除用户回调函数
		function sucess_deleteUser(data)
		{
			var PackDate=new UnPackData(data);
			if(PackDate.Content!=null)
			{
				if(PackDate.Content.RetCode=="0")
				{	
					$("#list4").jqGrid('delRowData', UserRowIndex);
					alert("删除用户成功！");
					UserRowIndex = -1;
					UserCont = UserCont -1;
					return;
				}
				else
				{
					alert("删除用户失败！");
					return;
				}
			}		
		}
			
		  function changeLanguage(lang) {
                TranslatePage(lang);
            }
		  jQuery(document).ready(function() {
			   // 调用模版也方法

				 parent.innerCallMe(true); 

				//更新权限
				parent.StartimeVideo();
				
				  //语言初始化
                initLang();

				//判断身份
				Authority();


			  //getUser();
					//psw dedao jiaodian		
					$("#psw").focus(function ()
					{ 
						$("#psw").val(""); 
					});
					//psw shiqu jiaodian
					$("#psw").blur(function ()
					{ 
						var stmp = $("#psw").val();
						if(stmp == "")
						{
							$("#psw").val("******");
						}
						else
						{
							UserPsw = stmp;
						}
					});
			  });
		//判断权限
		function Authority()
		{
			//如果不是管理员
			var ultmp = parent.UserLevel.indexOf("1");
			ultmp = parseInt(ultmp,10);
			//alert("parent.UserLevel:"+parent.UserLevel+"/r/nparent.UserAuth:"+parent.UserAuth);
			if(ultmp == -1 && parent.UserAuth != true)
			{
				//$("#submit").attr("disabled", "disabled");
				//$("#reset").attr("disabled", "disabled");
				
				$("#updateusers").css("display", "true");
				$("#adminuser").css("display", "none");
				document.getElementById("spyl_comp").disabled = true;
				document.getElementById("rzcx_comp").disabled = true;
				document.getElementById("yjkz_comp").disabled = true;
				document.getElementById("yydj_comp").disabled = true;
				document.getElementById("sptj_comp").disabled = true;
				document.getElementById("cspz_comp").disabled = true;
				document.getElementById("lxhf_comp").disabled = true;
				document.getElementById("xtwh_comp").disabled = true;
				document.getElementById("yhgl_comp").disabled = true;	
				//读取用户
				var username = getCookie("gmiwebusername");
				var userlever = parent.Authvalue; 
				var userflag = parent.UserLevel;
				UserPsw = getCookie("gmiwebpassword");
				//显示用户名
				$("#username").val(username);
				//用户类型
				if(userflag == "2")	//操作员
				{
					$("#usertype").val(2);
				}
				else if(userflag == "3")
				{
					$("#usertype").val(3);	
				}
				document.getElementById("spyl_comp").disabled = true;
				document.getElementById("rzcx_comp").disabled = true;
				document.getElementById("yjkz_comp").disabled = true;
				document.getElementById("yydj_comp").disabled = true;
				document.getElementById("sptj_comp").disabled = true;
				document.getElementById("cspz_comp").disabled = true;
				document.getElementById("lxhf_comp").disabled = true;
				document.getElementById("xtwh_comp").disabled = true;
				document.getElementById("yhgl_comp").disabled = true;
				
				//密码
				//$("#psw").val(userpsw);
				$("#psw").val("******");
				if(parent.VideoAuth == 0)
				{
					document.getElementById("spyl_comp").checked = false;
				}
				else if(parent.VideoAuth == 1)
				{
					document.getElementById("spyl_comp").checked = true;
				}
				
				if(parent.YunjingAuth == true)
				{
					document.getElementById("yjkz_comp").checked = true;
				}
				
				if(parent.yunydjAuth == true)
				{
					document.getElementById("yydj_comp").checked = true;
				}
				
				if(parent.shipinAuth == true)
				{
					document.getElementById("sptj_comp").checked = true;
				}
				
				if(parent.canspzAuth == true)
				{
					document.getElementById("cspz_comp").checked = true;
				}
				
			
				if(parent.LogAuth == true)
				{
					document.getElementById("rzcx_comp").checked = true;
				}
				
				if(parent.UserAuth == true)
				{
					document.getElementById("yhgl_comp").checked = true;
				}
		
				if(parent.sysweihu == true)
				{
					document.getElementById("xtwh_comp").checked = true;
				}
				
			
				if(parent.Recordhf == true)
				{
					document.getElementById("lxhf_comp").checked = true;
				}
			}
			else if(ultmp == 0 && parent.UserAuth == true)
			{
				$("#updateusers").css("display", "none");
				$("#adminuser").css("display", "true");
				 bindData();
			}
		}
		//修改提交
				//绑定确定按钮
                function updatepsw()
				{
					//Debugger:
					//获取用户名
					var userName = $("#username").val();
					//获取用户类型
					var userType = $("#usertype").val();
					//获取密码
					//var userPsw = $("#psw").val();
					if(userName == null || userName == "")
					{
						alert("用户名不能为空!");
						return;
					}
					if(userType == null || userType == "")
					{
						alert("用户类型不能为空!");
						return;
					}
					if(UserPsw == null || UserPsw == "")
					{
						alert("密码不能为空!");
						return;
					}
					if(!UserNameCheck(UserPsw))
					{
						alert("密码请不要超过31字节！");
						return;
					}
					var ctr = document.getElementById("spyl_comp");
					if(ctr.checked){spyl = true;}
					else if(!ctr.checked){spyl = false;}
					
					ctr = document.getElementById("rzcx_comp");
					if(ctr.checked){rzcx = true;}
					else if(!ctr.checked){rzcx = false;}
					
					ctr = document.getElementById("yjkz_comp");
					if(ctr.checked){yjkz = true;	}
					else if(!ctr.checked){yjkz = false;}
					
					ctr = document.getElementById("yydj_comp");
					if(ctr.checked){yydj = true;}
					else if(!ctr.checked){yydj = false;}
					
					ctr = document.getElementById("sptj_comp");
					if(ctr.checked){sptj = true;}
					else if(!ctr.checked){sptj = false;}
					
					ctr = document.getElementById("cspz_comp");
					if(ctr.checked){cspz = true;}
					else if(!ctr.checked){cspz = false;}
					
					ctr = document.getElementById("lxhf_comp");
					if(ctr.checked){lxhf = true;}
					else if(!ctr.checked){lxhf = false;}
					
					ctr = document.getElementById("yhgl_comp");
					if(ctr.checked){yhgl = true;}
					else if(!ctr.checked){yhgl = false;}	
					
					ctr = document.getElementById("xtwh_comp");
					if(ctr.checked){xtwh = true;}
					else if(!ctr.checked){xtwh = false;}
					//基本权限
				  var  content={};
				  content.SessionId=parent.parent.id;
				  content.AuthValue=parent.parent.Authvalue;
				  
				  //新用户
				  content.UserName = $("#username").val();
				  content.UserPass = UserPsw;//$("#psw").val();
				  content.UserFlag = userType;
				  //新用户权限
				  var str = "";
				  //系统维护
				  if(xtwh == true){str = "1";}
				  else if(!xtwh){str = "0";}
				  
				  //用户管理
				  if(yhgl == true){str += "1";}
				  else if(!yhgl){str += "0";}
				  
				  //参数配置
				  if(cspz == true){str += "1";}
				  else if(!cspz){str += "0";}
				  
				  //语音对讲
				  if(yydj == true){str += "1";}
				  else if(!yydj){str += "0";}   
				 
				  //日志查询
				  if(rzcx == true){str += "1";}
				  else if(!rzcx){str += "0";} 
				  
				  //录像回放
				  if(lxhf == true){str += "1";}
				  else if(!lxhf){str += "0";}
				  
				  //视频调节
				  if(sptj == true){str += "1";}
				  else if(!sptj){str += "0";}

				  //云镜控制
				  if(yjkz == true){str += "1";}
				  else if(!yjkz){str += "0";}
				  
				  //视频预览
				  if(spyl == true){str += "1";}
				  else if(!spyl){str += "0";}
				  
				  
				  //补齐后7位
				  var str1 = "0000000" + str;
				  
				  //alert(str1);
				  var strTmp = parseInt(str1,2);
				  //alert(strTmp);
				  
				  
				  content.UserLevel = strTmp;
				  contentstr=jsonToString(content);
				  GetAndSet("ModifyUsers","json",contentstr, sucess_UpdateUser);		  
				  
                }
			//修改用户回调函数
			function sucess_UpdateUser(data)
			{
				var PackDate=new UnPackData(data);
				if(PackDate.Content!=null)
				{
					if(PackDate.Content.RetCode=="0")
					{
						//成功返回
						alert("修改成功！");
					}
					else if(PackDate.Content.RetCode!="0")
					{
						//错误返回
						alert("修改失败!");	
					}
				}
				delete PackDate;	
			}
			//取消
			function cancepsw()
			{
				var userpsw = getCookie("gmiwebpassword");
				$("#psw").val(userpsw);	
			}
		//获取用户
		function getUser()
		{
			//先清空列表
			$("#list4" ).clearGridData(); 
			//$("#list4").jqGrid('delRowData', UserRowIndex);
			var  content={};
			content.SessionId=UserIndexID;
			content.AuthValue=parent.Authvalue;
			
			contentstr=jsonToString(content);
			GetAndSet("GetUsers","json",contentstr, sucess_getUser);	
		}
		//获取用户回调函数
		function sucess_getUser(data)
		{
			var PackDate=new UnPackData(data);
			if(PackDate.Content!=null)
			{
				if(PackDate.Content.RetCode=="0")
				{	
					UserCont = PackDate.Content.RealUserCnt;
					var mydata = {};
					mydata.length = UserCont;
					
					for(var i=1;i<=UserCont;i++)
					{
						//varUsernametmp = "UserName"+ i;
						//mydata[i] = [{name:PackDate.Content.(UseName),group:PackDate.Content.UserFlag,userinfo:' '}];
						//TestCode
						var st = 0;
						var jb = "";
						switch(i)
						{
							case 1:
							st = PackDate.Content.UserFlag0;
							if(st == 1)
							{
								jb = "管理员";	
							}
							else if(st == 2)
							{
								jb = "操作员";
							}
							else if(st == 3)
							{
								jb = "观察员";
							}
							//mydata[i-1] = [{name:PackDate.Content.UserName0,group:jb,userinfo:PackDate.Content.UserLevel0}];
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName0,group:jb,userinfo:PackDate.Content.UserLevel0,userpsw:PackDate.Content.UserPass0});
							break;
							case 2:
							st = PackDate.Content.UserFlag1;
							if(st == 1)
							{
								jb = "管理员";	
							}
							else if(st == 2)
							{
								jb = "操作员";
							}
							else if(st == 3)
							{
								jb = "观察员";
							}

							//mydata[i-1] = [{name:PackDate.Content.UserName1,group:jb,userinfo:PackDate.Content.UserLevel1}];
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName1,group:jb,userinfo:PackDate.Content.UserLevel1,userpsw:PackDate.Content.UserPass1});
							break;
							case 3:
							st = PackDate.Content.UserFlag2;
							if(st == 1)
							{
								jb = "管理员";	
							}
							else if(st == 2)
							{
								jb = "操作员";
							}
							else if(st == 3)
							{
								jb = "观察员";
							}

							//mydata[i-1] = [{name:PackDate.Content.UserName2,group:jb,userinfo:PackDate.Content.UserLevel2}];
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName2,group:jb,userinfo:PackDate.Content.UserLevel2,userpsw:PackDate.Content.UserPass2});
							break;
							case 4:
							st = PackDate.Content.UserFlag3;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName3,group:jb,userinfo:PackDate.Content.UserLevel3,userpsw:PackDate.Content.UserPass3});
							break;
							case 5:
							st = PackDate.Content.UserFlag4;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName4,group:jb,userinfo:PackDate.Content.UserLevel4,userpsw:PackDate.Content.UserPass4});
							break;
							case 6:
							st = PackDate.Content.UserFlag5;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName5,group:jb,userinfo:PackDate.Content.UserLevel5,userpsw:PackDate.Content.UserPass5});
							break;
							case 7:
							st = PackDate.Content.UserFlag6;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName6,group:jb,userinfo:PackDate.Content.UserLevel6,userpsw:PackDate.Content.UserPass6});
							break;
							case 8:
							st = PackDate.Content.UserFlag7;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName7,group:jb,userinfo:PackDate.Content.UserLevel7,userpsw:PackDate.Content.UserPass7});
							break;
							case 9:
							st = PackDate.Content.UserFlag8;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName8,group:jb,userinfo:PackDate.Content.UserLevel8,userpsw:PackDate.Content.UserPass8});
							break;
							case 10:
							st = PackDate.Content.UserFlag9;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName9,group:jb,userinfo:PackDate.Content.UserLevel9,userpsw:PackDate.Content.UserPass9});
							break;
							case 11:
							st = PackDate.Content.UserFlag10;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName10,group:jb,userinfo:PackDate.Content.UserLevel10,userpsw:PackDate.Content.UserPass10});
							break;
							case 12:
							st = PackDate.Content.UserFlag11;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName11,group:jb,userinfo:PackDate.Content.UserLevel11,userpsw:PackDate.Content.UserPass11});
							break;
						
							case 13:
							st = PackDate.Content.UserFlag12;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName12,group:jb,userinfo:PackDate.Content.UserLevel12,userpsw:PackDate.Content.UserPass12});
							break;
							case 14:
							st = PackDate.Content.UserFlag13;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName13,group:jb,userinfo:PackDate.Content.UserLevel13,userpsw:PackDate.Content.UserPass13});
							break;
							case 15:
							st = PackDate.Content.UserFlag14;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName14,group:jb,userinfo:PackDate.Content.UserLevel14,userpsw:PackDate.Content.UserPass14});
							break;
							case 16:
							st = PackDate.Content.UserFlag15;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName15,group:jb,userinfo:PackDate.Content.UserLevel15,userpsw:PackDate.Content.UserPass15});
							break;
							case 17:
							st = PackDate.Content.UserFlag16;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName16,group:jb,userinfo:PackDate.Content.UserLevel16,userpsw:PackDate.Content.UserPass16});
							break;
							case 18:
							st = PackDate.Content.UserFlag17;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName17,group:jb,userinfo:PackDate.Content.UserLevel17,userpsw:PackDate.Content.UserPass17});
							break;
						
							case 19:
							st = PackDate.Content.UserFlag18;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName18,group:jb,userinfo:PackDate.Content.UserLevel18,userpsw:PackDate.Content.UserPass18});
							break;
							case 20:
							st = PackDate.Content.UserFlag19;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName19,group:jb,userinfo:PackDate.Content.UserLevel19,userpsw:PackDate.Content.UserPass19});
							break;
							case 21:
							st = PackDate.Content.UserFlag20;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName20,group:jb,userinfo:PackDate.Content.UserLevel20,userpsw:PackDate.Content.UserPass20});
							break;
							case 22:
							st = PackDate.Content.UserFlag21;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName21,group:jb,userinfo:PackDate.Content.UserLevel21,userpsw:PackDate.Content.UserPass21});
							break;
							case 23:
							st = PackDate.Content.UserFlag22;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName22,group:jb,userinfo:PackDate.Content.UserLevel22,userpsw:PackDate.Content.UserPass22});
							break;
							case 24:
							st = PackDate.Content.UserFlag23;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName23,group:jb,userinfo:PackDate.Content.UserLevel23,userpsw:PackDate.Content.UserPass23});
							break;
							case 25:
							st = PackDate.Content.UserFlag24;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName24,group:jb,userinfo:PackDate.Content.UserLevel24,userpsw:PackDate.Content.UserPass24});
							break;
							case 26:
							st = PackDate.Content.UserFlag25;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName25,group:jb,userinfo:PackDate.Content.UserLevel25,userpsw:PackDate.Content.UserPass25});
							
							break;
							case 27:
							st = PackDate.Content.UserFlag26;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName26,group:jb,userinfo:PackDate.Content.UserLevel26,userpsw:PackDate.Content.UserPass26});
							
							break;
							case 28:
							st = PackDate.Content.UserFlag27;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName27,group:jb,userinfo:PackDate.Content.UserLevel27,userpsw:PackDate.Content.UserPass27});
							
							break;
							case 29:
							st = PackDate.Content.UserFlag28;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName28,group:jb,userinfo:PackDate.Content.UserLevel28,userpsw:PackDate.Content.UserPass28});
							
							break;
							case 30:
							st = PackDate.Content.UserFlag29;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName29,group:jb,userinfo:PackDate.Content.UserLevel29,userpsw:PackDate.Content.UserPass29});
							
							break;
							case 31:
							st = PackDate.Content.UserFlag30;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName30,group:jb,userinfo:PackDate.Content.UserLevel30,userpsw:PackDate.Content.UserPass30});
							
							break;
							case 32:
							st = PackDate.Content.UserFlag31;
							if(st == 1){jb = "管理员";	}else if(st == 2){jb = "操作员";}else if(st == 3){jb = "观察员";}
							jQuery("#list4").jqGrid('addRowData', i + 1, {name:PackDate.Content.UserName31,group:jb,userinfo:PackDate.Content.UserLevel31,userpsw:PackDate.Content.UserPass31});
							
							break;
							default:
							break;
						}	
					} 
					//mydata[0]=[{name:'admin',group:'管理员',userinfo:' '}];
					//mydata[1]=[{name:'admin',group:'管理员',userinfo:' '}];
					//mydata[2]=[{name:'admin',group:'管理员',userinfo:' '}];
					//var userInfo = getQueryString("UserLevel");
					//var username = PackDate.Content.UserName;
					//var mydata=[{name:PackDate.Content.UserName,group:PackDate.Content.UserFlag,userinfo:' '}];
					//if(parent.isZY)
					//{
						//mydata.length= 2;
						//mydata[0]=[{name:'admin',group:'管理员',userinfo:' '}];mydata[1]=[{name:'admin',group:'管理员',userinfo:' '}];
					//}
				
                	//alert(mydata);
                	//for (var i = 0; i < mydata.length; i++) {
                   	//	jQuery("#list4").jqGrid('addRowData', i + 1, mydata[i]);
               	 	//}
					//jQuery("#list4").jqGrid('addRowData', 2, mydata[0]);
					//重新加载。开始分页
				 	//jQuery("#list4").trigger("reloadGrid");
				}
			}	
		}
		 function bindData() {
				// jQuery("#list4").jqGrid("clearGridData");
                jQuery("#list4").jqGrid({ //装在数据的table id

                    datatype: "local",
                    height: 230,
                    colNames: ['用户名称', '用户分组', '用户信息','用户密码'],

                    colModel: [{
                        name: 'name',
                        index: 'name',
                        width: 400,
						align:"center"
                    },
                    {
                        name: 'group',
                        index: 'group',
                        width: 400,
						align:"center"
                    },
					
                    {
                        name: 'userinfo',
                        index: 'userinfo',
                        width: 0.5,
						align:"center",
						hidden:"true"
                    },
                    {
                        name: 'userpsw',
                        index: 'userpsw',
                        width: 0.5,
						align:"center",
						hidden:"true"
                    }],
					

                    viewrecords: true,
                    //是否显示行数  
                    pager: "logListPager",
                    //分页显示的DIVID
                    rowNum: 10,
                    //每页20条记录 
                    rowList: [10, 20, 30],
                    //可调整每页显示的记录数    
                    sortname: "name",
                    //默认排序的列名 
                    sortorder: "desc",
                    //默认排序的顺序
                    //scroll:true,//鼠标滚动翻页
                    multiselect: false,
                    caption: "  ",
					
					//定位当前行
                    onSelectRow:function(id){
						UserIndex = $("#list4").jqGrid('getRowData', id); 
						UserIndexID = UserIndex.name;
						UserIdexLever= UserIndex.userinfo;//用户权限
						//alert("UserIdexLever:"+UserIdexLever);
						UserIndexFlag =UserIndex.group;;//用户类型
						UserPsw = UserIndex.userpsw;//用户密码
						
						UserRowIndex = $("#list4"). jqGrid('getGridParam', 'selrow'); 
						//UserIndexFlag = UserIndex.group;
						//UserIndexLevel = UserIndex.userinfo;
						}
                });
				getUser();
				/*
				var mydata=[{name:'inc',group:'管理员',userinfo:' '}];
				if(parent.isZY)
				{
					mydata=[{name:'admin',group:'管理员',userinfo:' '}];
				}
				
				//mydata.length = 3;
					//mydata[0]=[{name:'admin',group:'管理员',userinfo:' '}];
					//mydata[1]=[{name:'admin',group:'管理员',userinfo:' '}];
					//mydata[2]=[{name:'admin',group:'管理员',userinfo:' '}];
					//mydata=[{name:'inc',group:'管理员',userinfo:' '},{name:'inc',group:'管理员',userinfo:' '},{name:'inc',group:'管理员',userinfo:' '}];
                //alert(mydata);
				//getUser();
                for (var i = 0; i < mydata.length; i++) {
                    jQuery("#list4").jqGrid('addRowData', i + 1, mydata[i]);
                }
				//jQuery("#list4").jqGrid('addRowData', 2, [{name:'gmi1',group:'操作员',userinfo:' '}]);
				//重新加载。开始分页
				 jQuery("#list4").trigger("reloadGrid");
				 */
				 
		 }
		 
		 //列表点击事件
		 function tableclick(o)
		 {
			 //当前行号
			 var index = o.srcElement.parentNode.parentNode.rowIndex; 
			 alert(index);
		 }
		 //检验用户是否存在
		 function CheckUser(username)
		 {
			 var curTbl = document.getElementById("list4");
			 var Lenr = curTbl.rows.length;
     		for (i = 0; i < Lenr; i++) 
     		{ 
         		var Lenc = curTbl.rows(i).cells.length; 
				if(username == curTbl.rows(i).cells(0).innerText)
				{
					return false;
				}	
     		}
			return true;
		 }
		//判断用户名位数
		function UserNameCheck(username)
		{
			var lengthuser = username.length;
			if(lengthuser > 31)
			{
				return false;
			}
			
			return true;
		}
		</script> 
</head>

<body> 
 
 
 
 <div class="bit-stream">
<h3 style="font-size:14px; font-weight:bold;">用户管理</h3>
                                </div> 
                                 
                         
                <div class="down_main_content" id="adminuser">
                		<div class="ip_set_main">
                        	 
                              	
                            
                            	
                                  <table id="list4" >
                </table>
                                 
                                 
                              <div class="video_top"><div class="sd_manage_1" style="width:250px;"></div><div class="sd_manage_1"><a class="btn22" style="background:url(images/btn1.jpg) no-repeat; color: #000;" onclick="openwin()">添加</a></div><div class="sd_manage_1"><a class="btn22" style="background:url(images/btn1.jpg) no-repeat; color: #000;" onclick="updateUser()">修改</a></div>
                              <div class="sd_manage_1"><a class="btn22" style="background:url(images/btn1.jpg) no-repeat; color: #000;" onclick="deleteUser()">删除</a></div>
                              </div>
                          		  
						 </div>
                 </div>   
                 
                 
<div style="width:400px; height:400px; margin:0 auto; padding-left:110px;  text-align:left; " id="updateusers">
            
            <dl>
                <dt style="width:200px;">&nbsp;</dt>
                	<div style="width:90%">
                <div class="user_list">
                <div class="user_list1" >用户名：</div>
                  <div class="user_list1"><input type="text" id="username" disabled="disabled"></input></div>
                
                </div>
                <div class="user_list">
                <div class="user_list1">用户类型:</div>
                <div class="user_list1">
                  <select id="usertype" disabled="disabled" >
                    <!--<option value='1'> 管理员 </option>-->
                    <option value='2'> 操作员 </option>
                    <option value='3'> 观察员 </option>
                  </select>
                  </div>
                </div>
                <div class="user_list">
              <div class="user_list1">密   码：</div>
              <div class="user_list1">    
                  <input type="password" id="psw" ></input></div>
                  </div>
				</div>
                
                <div class="user_list2" style="height:24px;">
                
               <div class="user_list1">基本权限:</div>
              <div class="user_list1">    
                  </div>
                  </div>
            </dl>
          <!--<p>-->
          <div class="user_list3">
            <input id="spyl_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>视频预览 </div>
          <div class="user_list3"><input id="rzcx_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>日志查询</div>
          <div class="user_list3">
		  <input id="yjkz_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>云镜控制</div>
          <div class="user_list3">
          <input id="yydj_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>语音对讲</div>
          <div class="user_list3">
          <input id="sptj_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>视频调节</div>
          <div class="user_list3">
          <input id="cspz_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>参数配置</div>
          <div class="user_list3" style="display:none;">
          <input id="lxhf_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>录像回放</div>
          <div class="user_list3">
          <input id="yhgl_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>用户管理</div>
<div class="user_list3">
          <input id="xtwh_comp" name="" type="checkbox" style="border:0 none; width:30px;"/>系统维护</div>
          
          <div style="width:300px;   text-align:center;;">
            <input type="button" class="btn3" value="确定" id="submitAdduser" onclick="updatepsw()"
            />
          <input type="button" class="btn3" value="取消" id="cancelircut" onclick="cancepsw()"
            /></div>
		</div>    
                                  
                             
</body>
</html>
